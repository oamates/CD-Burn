///////////////////////////////////////////////////////////////////////////////
/******************************************************************************
	Project		ZMediaServer
	ZRTCPTask	Header File
	Create		20110120		ZHAOTT		RTCP
******************************************************************************/
///////////////////////////////////////////////////////////////////////////////
#ifndef	_ZRTCPTASK_H_
#define	_ZRTCPTASK_H_
///////////////////////////////////////////////////////////////////////////////
#include "ZTask.h"
#include "ZOSArray.h"
#include "ZOSObjectTable.h"
#include "ZRTPSocketPool.h"
///////////////////////////////////////////////////////////////////////////////
class	ZRTCPPacket;
class	ZRTCPTask;
class	ZUDPSocket;
class	ZRTPStream;
class	ZUDPSocketPair;
///////////////////////////////////////////////////////////////////////////////
typedef	ZOSArray<ZUDPSocketPair*>			ZRTPSocketTable;
///////////////////////////////////////////////////////////////////////////////
class ZRTCPTask : public ZTask
{
///////////////////////////////////////////////////////////////////////////////
public:
	ZRTCPTask();
	virtual ~ZRTCPTask();
///////////////////////////////////////////////////////////////////////////////
public:
	virtual	BOOL	Create();
	virtual	BOOL	Close();
///////////////////////////////////////////////////////////////////////////////
public:
	BOOL	AddSocket(ZUDPSocketPair* pSocketPair);
	BOOL	RegisterStream(ZRTPStream* pStream);
	BOOL	UnRegisterStream(ZRTPStream* pStream);
///////////////////////////////////////////////////////////////////////////////
protected:
	virtual	int		Run(int nEvent = 0);
	virtual	BOOL	OnReciveRTCPPacket();
///////////////////////////////////////////////////////////////////////////////
protected:
	ZOSMutex		m_StreamMutex;
	ZRTPSocketTable	m_StreamSocket;
	ZOSObjectTable	m_StreamTable;
///////////////////////////////////////////////////////////////////////////////
public:
	static	ZRTCPTask*	m_pRTCPTask;
///////////////////////////////////////////////////////////////////////////////
public:
	static	void	Initialize();
	static	void	Uninitialize();
///////////////////////////////////////////////////////////////////////////////
public:
	static	ZRTCPTask*	GetRTCPTask();
///////////////////////////////////////////////////////////////////////////////
};
///////////////////////////////////////////////////////////////////////////////
#endif	//_ZRTCPTASK_H_
///////////////////////////////////////////////////////////////////////////////
